{
"description":"run tophat2 to to align input bam to supplied reference genome",
"subgraph_io":{
	"ports":{
		"inputs":{
			"_stdin_":"bamtofastq",
			"reference":"tophat2:__REFERENCE_GENOME__"
		},
		"outputs":{
			"_stdout_":"bamcat"
		}
	}
},
"nodes":[
	{
		"id":"bamtofastq",
		"type":"EXEC",
		"use_STDIN": true,
		"use_STDOUT": false,
		"cmd":["bamtofastq", "gz=1", "F=__FQOUT1__", "F2=__FQOUT2__"]
	},
	{
		"id":"fq1",
		"type":"RAFILE",
		"name":{"subst_param_name":"fastq1",
			"required":"yes",
			"subst_constructor":{
				"vals":[
					{"subst_param_name":"tmpdir","required":"no","default":"."},
					"/",
					{"subst_param_name":"fastq1_name",
						"required":"no",
						"default":"intfile_1.fq.gz",
						"subst_constructor":{
							"vals":[
								"intfile_1_",
								{"subst_param_name":"rpt","required":"yes"},
								".fq.gz"
							],
							"postproc":{"op":"concat", "pad":""}
						}
					}
				],
				"postproc":{"op":"concat", "pad":""}
			}
		}
	},
	{
		"id":"fq2",
		"type":"RAFILE",
		"name":{"subst_param_name":"fastq2",
			"required":"yes",
			"subst_constructor":{
				"vals":[
					{"subst_param_name":"tmpdir","required":"no","default":"."},
					"/",
					{"subst_param_name":"fastq2_name",
						"required":"no",
						"default":"intfile_2.fq.gz",
						"subst_constructor":{
							"vals":[
								"intfile_2_",
								{"subst_param_name":"rpt","required":"yes"},
								".fq.gz"
							],
							"postproc":{"op":"concat", "pad":""}
						}
					}
				],
				"postproc":{"op":"concat", "pad":""}
			}
		}
	},
	{
		"id":"tophat2",
		"type":"EXEC",
		"use_STDIN": false,
		"use_STDOUT": false,
		"cmd":{"subst_param_name":"tophat2_cmd",
			"required":"yes",
			"subst_constructor":{
				"vals":[
					"tophat2",
					"--no-sort-bam",
					"--output-dir",
					{"subst_param_name":"tophat_out",
						"required":"no",
						"subst_constructor":{
							"vals":[
								{"subst_param_name":"tophat_dir","required":"no","default":"tophat_out"},
								"_",
								{"subst_param_name":"rpt","required":"yes"}
							],
							"postproc":{"op":"concat","pad":""}
						},
						"default":"tophat_out"
					},
					"--mate-inner-dist","100",
					"--num-threads",{"subst_param_name":"aligner_numthreads","required":"no","default":"12"},
					"--library-type", {"subst_param_name":"library_type","required":"no","default":"fr-firststrand"},
					"--no-coverage-search",
					"--microexon-search",
					{"subst_param_name":"transcriptome_flag_val",
						"required":"no",
						"subst_constructor":{
							"vals":[
								"--transcriptome-index",
								{"subst_param_name":"transcriptome_val",
									"subst_constructor":{
										"vals":[
											{"subst_param_name":"reposdir","required":"no"},
											"/transcriptomes/",
											{"subst_param_name":"transcriptome_subpath","required":"no"}
										],
										"postproc":{"op":"concat","pad":""}
									}
								}
							],
							"postproc":{"op":"concat","pad":"="}
						}
					},
					"__REFERENCE_GENOME__",
					"__FQIN1__",
					"__FQIN2__"
				],
				"postproc":{"op":"pack","pad":" "}
			}
		}
	},
	{
		"id":"junctions_bed",
		"type":"RAFILE",
		"subtype":"DUMMY",
		"name":{"subst_param_name":"junctions_bed",
			"required":"no",
			"subst_constructor":{
				"vals":[
					{"subst_param_name":"tophat_dir","required":"no","default":"tophat_out"},
					"_",
					{"subst_param_name":"rpt","required":"yes"},
					"/junctions.bed"
				],
				"postproc":{"op":"concat","pad":""}
			},
			"default":"tophat_out/junctions.bed"
		}
	},
	{
		"id":"insertions_bed",
		"type":"RAFILE",
		"subtype":"DUMMY",
		"name":{"subst_param_name":"insertions_bed",
			"required":"no",
			"subst_constructor":{
				"vals":[
					{"subst_param_name":"tophat_dir","required":"no","default":"tophat_out"},
					"_",
					{"subst_param_name":"rpt","required":"yes"},
					"/insertions.bed"
				],
				"postproc":{"op":"concat","pad":""}
			},
			"default":"tophat_out/insertions.bed"
		}
	},
	{
		"id":"deletions_bed",
		"type":"RAFILE",
		"subtype":"DUMMY",
		"name":{"subst_param_name":"deletions_bed",
			"required":"no",
			"subst_constructor":{
				"vals":[
					{"subst_param_name":"tophat_dir","required":"no","default":"tophat_out"},
					"_",
					{"subst_param_name":"rpt","required":"yes"},
					"/deletions.bed"
				],
				"postproc":{"op":"concat","pad":""}
			},
			"default":"tophat_out/deletions.bed"
		}
	},
	{
		"id":"accepted_hits_bam",
		"type":"RAFILE",
		"subtype":"DUMMY",
		"name":{"subst_param_name":"accepted_hits_bam",
			"required":"no",
			"subst_constructor":{
				"vals":[
					{"subst_param_name":"tophat_dir","required":"no","default":"tophat_out"},
					"_",
					{"subst_param_name":"rpt","required":"yes"},
					"/",
					{"subst_param_name":"accepted_hits","required":"no","default":"accepted_hits.bam"}
				],
				"postproc":{"op":"concat","pad":""}
			},
			"default":"tophat_out/accepted_hits.bam"
		}
	},
	{
		"id":"unmapped_bam",
		"type":"RAFILE",
		"subtype":"DUMMY",
		"name":{"subst_param_name":"unmapped_bam",
			"required":"no",
			"subst_constructor":{
				"vals":[
					{"subst_param_name":"tophat_dir","required":"no","default":"tophat_out"},
					"_",
					{"subst_param_name":"rpt","required":"yes"},
					"/",
					{"subst_param_name":"unmapped","required":"no","default":"unmapped.bam"}
				],
				"postproc":{"op":"concat","pad":""}
			},
			"default":"tophat_out/unmapped.bam"
		}
	},
	{
		"id":"bamcat",
		"type":"EXEC",
		"cmd":"bamcat I=__IN_BAM1__ I=__IN_BAM2__ level=0"
	},
	{
		"id":"cp_deletions_bed",
		"type":"EXEC",
		"use_STDIN": false,
		"use_STDOUT": false,
		"cmd":{
			"subst_param_name":"cp_deletions_bed",
			"required":"no",
			"subst_constructor":{
				"vals":[
					"cp ",
					"__SRC_DELETIONS_BED__ ",
					{"subst_param_name":"outdatadir","required":"yes"},
					"/",
					{"subst_param_name":"rpt","required":"yes"},
					".deletions.bed"
				],
				"postproc":{"op":"concat","pad":""}
			}
		}
	},
	{
		"id":"cp_insertions_bed",
		"type":"EXEC",
		"use_STDIN": false,
		"use_STDOUT": false,
		"cmd":{
			"subst_param_name":"cp_insertions_bed",
			"required":"no",
			"subst_constructor":{
				"vals":[
					"cp ",
					"__SRC_INSERTIONS_BED__ ",
					{"subst_param_name":"outdatadir","required":"yes"},
					"/",
					{"subst_param_name":"rpt","required":"yes"},
					".insertions.bed"
				],
				"postproc":{"op":"concat","pad":""}
			}
		}
	},
	{
		"id":"cp_junctions_bed",
		"type":"EXEC",
		"use_STDIN": false,
		"use_STDOUT": false,
		"cmd":{
			"subst_param_name":"cp_junctions_bed",
			"required":"no",
			"subst_constructor":{
				"vals":[
					"cp ",
					"__SRC_JUNCTIONS_BED__ ",
					{"subst_param_name":"outdatadir","required":"yes"},
					"/",
					{"subst_param_name":"rpt","required":"yes"},
					".junctions.bed"
				],
				"postproc":{"op":"concat","pad":""}
			}
		}
	}
],
"edges":[
	{
		"id":"bamtofastq_to_fq1",
		"from":"bamtofastq:__FQOUT1__",
		"to":"fq1"
	},
	{
		"id":"bamtofastq_to_fq2",
		"from":"bamtofastq:__FQOUT2__",
		"to":"fq2"
	},
	{
		"id":"fq1_to_tophat2",
		"from":"fq1",
		"to":"tophat2:__FQIN1__"
	},
	{
		"id":"fq2_to_tophat2",
		"from":"fq2",
		"to":"tophat2:__FQIN2__"
	},
	{
		"id":"tophat2_to_accepted_hits_bam",
		"from":"tophat2",
		"to":"accepted_hits_bam"
	},
	{
		"id":"tophat2_to_unmapped_bam",
		"from":"tophat2",
		"to":"unmapped_bam"
	},
	{
		"id":"tophat2_to_deletions_bed",
		"from":"tophat2",
		"to":"deletions_bed"
	},
	{
		"id":"cp_deletions_bed",
		"from":"deletions_bed",
		"to":"cp_deletions_bed:__SRC_DELETIONS_BED__"
	},
	{
		"id":"tophat2_to_insertions_bed",
		"from":"tophat2",
		"to":"insertions_bed"
	},
	{
		"id":"cp_insertions_bed",
		"from":"insertions_bed",
		"to":"cp_insertions_bed:__SRC_INSERTIONS_BED__"
	},
	{
		"id":"tophat2_to_junctions_bed",
		"from":"tophat2",
		"to":"junctions_bed"
	},
	{
		"id":"cp_junctions_bed",
		"from":"junctions_bed",
		"to":"cp_junctions_bed:__SRC_JUNCTIONS_BED__"
	},
	{
		"id":"accepted_hits_bam_to_bamcat",
		"from":"accepted_hits_bam",
		"to":"bamcat:__IN_BAM1__"
	},
	{
		"id":"unmapped_bam_to_bamcat",
		"from":"unmapped_bam",
		"to":"bamcat:__IN_BAM2__"
	}
]
}
